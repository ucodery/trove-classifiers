name: publish new classifiers
on:
  schedule:
    - cron:  '1 2 * * *'
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
        - name: checkout
          uses: actions/checkout@v3
        - name: install deps
          run: |
            python -m pip install trove-classifiers
            cargo install cargo-bump
        - name: build with latest trove
          run: |
            cd src/
            python build.py
        - name: version bump if changed
          run: |
            git diff --exit-code
            if [[ $? -eq 1 ]]; then
              cargo bump minor --git-tag
            else
              exit 1
            fi
        - name: commit and push
          uses: stefanzweifel/git-auto-commit-action@v5
          with:
            commit_message: New trove classifiers
        - name: build
          uses: actions-rs/toolchain@v1
          with:
              toolchain: stable
              override: true
        - name: publish
          uses: katyo/publish-crates@v2
          with:
              registry-token: ${{ secrets.CARGO_REGISTRY_TOKEN }}
